<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="thara">
  <title>ブログをGithub Pagesに移行した | thara.dev</title>
  <link rel="stylesheet" href="/css/main.css">
</head>
<body>
  <header>
    <h1>
      <a href="">thara.dev</a>
    </h1>
  </header>
  <div role="main">
    <div>
      <h1>ブログをGithub Pagesに移行した</h1>
      <span>2017-01-17</span>
    </div>
    <article>
    <p>昨年、ブログをGhost(Self-Hosting)に移行したけど、どうしてもプレーンテキストの安心感が忘れられず、Github PagesもといJekyllに戻してしまった。。。<br>
それほど手間はかからなかったが、一応メモ。</p>
<h2>なぜGithub pagesか</h2>
<p>Github pagesであれば、わざわざ静的サイトをCIなどでgenerateせずともサイトに反映できるし、Github自体がなくなったとしても、プレーンテキストなのでどうにでもなる。
Githubのprivate repositoryでもGithub pagesは公開されるので、公開サイトの元データを外部に晒すこともなし。<br>
運用面でもとても楽。</p>
<p>Ghostに移行した理由はChromebookから編集できない、という点であったが、よくよく考えるとGithub上からもファイル追加・編集・削除できたのだった・・・<br>
半年後に気づくとは・・・ 😫</p>
<h2>Github pages用Gemfile</h2>
<p>Github pagesは、Githubサーバー上でのJekyllやそのプラグインのバージョンに制限があるので、ローカルマシンで確認する場合はgemのバージョンをGithub上の環境に合わせておいたほうがよい。
ありがたいことに<a href="https://rubygems.org/gems/github-pages">github-pages</a> というgemで依存関係がまとめられているので、これを使用する。</p>
<p>Gemfileはこんな感じ。</p>
<pre><code class="language-ruby">source &quot;https://rubygems.org&quot;

gem &quot;jekyll&quot;, &quot;3.3.1&quot;
gem 'github-pages', &quot;115&quot;, group: :jekyll_plugins

gem &quot;minima&quot;
gem 'jekyll-compose', group: [:jekyll_plugins]

group :jekyll_plugins do
  gem &quot;jekyll-feed&quot;, &quot;~&gt; 0.6&quot;
end
</code></pre>
<p>jekyll-compose は便利コマンドがほしかったので入れといた。<br>
テーマは minima。
テーマはこだわっても仕方がないし、Webデザインをアピールしたいわけでもないので、このままでいいや。</p>
<h2>Ghostからの移行</h2>
<p>Ghostはブログのデータをexportする機能がlabに含まれているので、それを使用。<a href="https://help.ghost.org/hc/en-us/articles/224112927-Import-Export-Data">参考</a><br>
Content-Security-Policy の設定が厳しいからかダウンロードダイアログが出なかったので、URLをコピって直接ダウンロードした。</p>
<p>GhostがexportするフォーマットはJSONであるため、Markdownに変換する必要がある。<br>
<a href="https://github.com/eloyesp/jekyll_ghost_importer">jekyll_ghost_importer</a> を使うと、Ghostがexportしたデータから_postディレクトリ内にMarkdownファイルを生成してくれるので、それをありがたく使わせていただいた。<br>
ただ、バージョン0.4.0では、ブログエントリか静的ページかを問わず、全てのコンテンツを_postsに出力してしまうため、Jekyllで静的ページをブログエントリにしたくない場合は手作業でファイルを移動したりlayout設定を変更したりしなければならない。<br>
（エントリ内画像はどのようにexportされるかはexportしたブログエントリ内に画像が含まれていないので分からない）</p>
<h2>カスタムドメインのHTTPSについて</h2>
<p>以前は、Ghostを適当な非公開portでlistenさせておいて、Nginxでリバースプロキシ &amp; HTTPS化させていた。
Github pageにも https://blog.thara.jp でアクセスできるように以下のようにNginxを設定。</p>
<pre><code>server {
    listen       443;
    server_name  blog.thara.jp;
(略)
    location / {
        proxy_pass https://{Github page URL};
        proxy_intercept_errors on;
        expires off;
    }
}
</code></pre>
<p>だいたいブログの構築して満足してしまって全然エントリを書けていない・・・</p>
<p>2017年は週1で更新できるように頑張る ✊</p>

    </article>
  </div>
  <footer>
  <small>
    <a href="">Home</a>
    | <a href="https://github.com/thara/thara.github.io">GitHub</a>
    | <a href="/about">About</a>
    | <a href="/resume-ja">Resume(ja)</a>
    | &copy; 2022 thara
  </small>
</footer>
</body>
</html>

