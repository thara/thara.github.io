<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Tomochika Hara">
  <title>thara</title>
  <link rel="stylesheet" href="https://thara.github.io/css/main.css">
</head>
<body>
  <header>
    <h1>
      <a href="https://thara.github.io">thara</a>
    </h1>
  </header>
  <div role="main">
    <div>
      <h1>aws-cliでEC2インスタンスを作成するときのメモ</h1>
        <span>2017-06-01</span>
    </div>
    <article>
<p>毎回ググってる気がするのでメモ。</p>
<h2 id="-">準備</h2>
<h4 id="-">使用するツール</h4>
<p><a href="https://github.com/aws/aws-cli">aws-cli</a></p>
<h4 id="-">インストール</h4>

<pre><code>$ pip install awscli
</code></pre>
<h4 id="-">プロファイル設定</h4>

<pre><code>$ aws configure --profile ${プロファイル名｝
</code></pre>
<p>アクセスキーID、シークレットアクセスキー、デフォルトリージョン、出力フォーマットを指定。
出力フォーマットはだいたい <code>json</code> にしてる。 <code>jq</code> コマンドで使うので。</p>
<h2 id="ec2-">EC2インスタンス作成</h2>
<h3 id="-">キーペア作成</h3>
<p>（必要であれば）</p>

<pre><code>$ aws --profile=${プロファイル名｝ ec2 create-key-pair \
    --key-name ${新規キー名} \
    --query &#39;KeyMaterial&#39; \
    --output text \
    &gt; $HOME/.ssh/${保存する秘密鍵のファイル名} \
    &amp;&amp; chmod 400 $HOME/.ssh/${保存する秘密鍵のファイル名}
</code></pre>
<h3 id="-">インスタンス作成</h3>
<p><em>設定するSecurityGroupとSubnetを事前に調べておく</em></p>

<pre><code>$ aws --profile=${プロファイル名｝ ec2 describe-security-groups | jq -c &quot;.SecurityGroups[] | [.GroupName,.GroupId]&quot;
$ aws --profile=${プロファイル名｝ ec2 describe-subnets | jq -c &quot;.Subnets[] | [.Tags[0].Value,.SubnetId]&quot;
</code></pre>

<pre><code>aws --profile=${プロファイル名｝ ec2 run-instances \
    --image-id ami-923d12f5 \
    --instance-type t2.micro \
    --key-name ${新規キー名} \
    --security-group-ids ${SecurityGroupのGroupID} \
    --subnet-id ${SubnetのSubnetID} \
    --monitoring Enabled=true
</code></pre>
<p>インスタンスIDを控えておく。</p>
<h3 id="-">インスタンスに名前を付ける</h3>

<pre><code>$ aws --profile=${プロファイル名} ec2 create-tags --resources ${インスタンスID} --tags Key=Name,Value=&quot;${インスタンス名}&quot;
</code></pre>

    </article>
  </div>
  <footer>
    <small>
      <a href="https://thara.github.io">Home</a>
      | <a href="https://github.com/thara/thara.github.io">GitHub</a>
      | <a href="https://thara.github.io/about">About</a>
      | &copy; 2021 Tomochika Hara
    </small>
  </footer>
</body>
</html>
