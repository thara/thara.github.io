<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Tomochika Hara">
  <title>Djangoアプリケーションのモジュール構成再考 - thara.dev</title>
  <link rel="stylesheet" type="text/css" href="https://thara.dev/css/neat.css">
  <link rel="stylesheet" type="text/css" href="https://thara.dev/css/custom.css">
  <meta name="og:title" content="Djangoアプリケーションのモジュール構成再考 - thara.dev" />
  <meta name="og:type" content="article" />
  <meta name="og:site_name" content="thara.dev" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@zetta1985" />
  <meta name="twitter:title" content="Djangoアプリケーションのモジュール構成再考 - thara.dev" />
  <meta name="Hatena::Bookmark" content="nocomment" />
  <link rel="author" href="http://www.hatena.ne.jp/zetta1985/" /></head>
<body>
  <header>
    <h1>Djangoアプリケーションのモジュール構成再考</h1>
    <ul>
      <li>published: <time>2017-01-26</time></li>
    </ul>
  </header>
  <div role="main">
    <article>
<p>[以前のDjangoモジュール構成のpost]({% post_url
2016-12-09-module-configuration-of-django-app %})
では、論理凝集度が高過すぎる感があって、もっと機能凝集度を高めたモジュール構成を考えてみた。<br />
もちろんDjangoアプリケーションは細かく分けることを前提。</p>
<p>以下、全体像を簡単に図示。</p>
<p>![Django App Structure]({{ site.url
}}/images/django-app-structure.png)</p>
<p>各要素を説明すると...</p>
<ul>
<li>View
<ul>
<li>DjangoのView定義</li>
</ul></li>
<li>Model
<ul>
<li>Django Model定義</li>
<li>他のModelへのクエリ/更新をしない</li>
<li>Fat Modelにしない</li>
</ul></li>
<li>Domain
<ul>
<li>機能単位のモジュール。機能を満たす関数やクラスを定義する。</li>
<li>モジュール内には、さらに以下を定義する
<ul>
<li>Command
<ul>
<li>更新系ユースケースを表すアプリケーションサービス。Viewから使用。</li>
</ul></li>
<li>Query
<ul>
<li>参照系ユースケースを表すアプリケーションサービス。Viewから使用。</li>
</ul></li>
</ul></li>
</ul></li>
<li>Infrastructure
<ul>
<li>Domainの実装のうち、Redisやメール送信、Celeryなどの外部サービスのAPIを使用する実装を置く。</li>
<li>DjangoのModelはInfrastructureの責務には <strong>含めない</strong>
<ul>
<li>フルスタックフレームワークを使用している以上、Django
Modelへの依存を避けようとすると、フレームワークの良さを殺してしまう</li>
</ul></li>
</ul></li>
</ul>
<p>以下、ファイル構造の一例。</p>
<pre><code>social_game_api
├── friend
│   ├── models.py  (Model)
│   ├── request.py (Domain)
│   ├── request_tasks.py (Infrastructure: Celery)
│   ├── urls.py
│   └── views.py (View)
└── user
    ├── login.py (Domain)
    ├── login_repos.py (Infrastructure: Redis)
    ├── loginbonus.py (Domain)
    ├── models.py (Model)
    ├── profile.py (Domain)
    ├── signup.py (Domain)
    ├── urls.py
    └── views.py (View)</code></pre>
<p>モジュール名は <code>{Domain}_{Infrastructure type}</code>
という法則にすることで、どのDomainのどのようなInfrastructureを使用するモジュールかが分かりやすくなる。<br />
また、他のDjangoアプリケーションからアクセスできるのは、ModelsとDomainに限定する。<br />
Domainでは、他のDomainを参照することにより循環参照になることがある。その場合は、関数やメソッド内でimportするか、別モジュールに切り出すなどして回避する。</p>
<p>やっぱり、Simple is best.</p>
    </article>
  </div>
<footer>
  <small>
    <a href="https://thara.dev">thara.jp</a>
    | &copy; 2024 Tomochika Hara
  </small></footer>
</body>
</html>
