<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Tomochika Hara">
  <title>ブログをGithub Pagesに移行した - thara.dev</title>
  <link rel="stylesheet" type="text/css" href="https://thara.dev/css/neat.css">
  <link rel="stylesheet" type="text/css" href="https://thara.dev/css/custom.css">
  <meta name="og:title" content="ブログをGithub
Pagesに移行した - thara.dev" />
  <meta name="og:type" content="article" />
  <meta name="og:site_name" content="thara.dev" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@zetta1985" />
  <meta name="twitter:title" content="ブログをGithub
Pagesに移行した - thara.dev" />
  <meta name="Hatena::Bookmark" content="nocomment" />
  <link rel="author" href="http://www.hatena.ne.jp/zetta1985/" /></head>
<body>
  <header>
    <h1>ブログをGithub Pagesに移行した</h1>
    <ul>
      <li>published: <time>2017-01-17</time></li>
    </ul>
  </header>
  <div role="main">
    <article>
<p>昨年、ブログをGhost(Self-Hosting)に移行したけど、どうしてもプレーンテキストの安心感が忘れられず、Github
PagesもといJekyllに戻してしまった。。。<br />
それほど手間はかからなかったが、一応メモ。</p>
<h2 id="なぜgithub-pagesか">なぜGithub pagesか</h2>
<p>Github
pagesであれば、わざわざ静的サイトをCIなどでgenerateせずともサイトに反映できるし、Github自体がなくなったとしても、プレーンテキストなのでどうにでもなる。
Githubのprivate repositoryでもGithub
pagesは公開されるので、公開サイトの元データを外部に晒すこともなし。<br />
運用面でもとても楽。</p>
<p>Ghostに移行した理由はChromebookから編集できない、という点であったが、よくよく考えるとGithub上からもファイル追加・編集・削除できたのだった・・・<br />
半年後に気づくとは・・・ 😫</p>
<h2 id="github-pages用gemfile">Github pages用Gemfile</h2>
<p>Github
pagesは、Githubサーバー上でのJekyllやそのプラグインのバージョンに制限があるので、ローカルマシンで確認する場合はgemのバージョンをGithub上の環境に合わせておいたほうがよい。
ありがたいことに<a
href="https://rubygems.org/gems/github-pages">github-pages</a>
というgemで依存関係がまとめられているので、これを使用する。</p>
<p>Gemfileはこんな感じ。</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>source <span class="st">&quot;https://rubygems.org&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>gem <span class="st">&quot;jekyll&quot;</span>, <span class="st">&quot;3.3.1&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>gem <span class="vs">&#39;github-pages&#39;</span>, <span class="st">&quot;115&quot;</span>, <span class="wa">group: :jekyll_plugins</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>gem <span class="st">&quot;minima&quot;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>gem <span class="vs">&#39;jekyll-compose&#39;</span>, <span class="wa">group: </span><span class="kw">[</span><span class="wa">:jekyll_plugins</span><span class="kw">]</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>group <span class="wa">:jekyll_plugins</span> <span class="cf">do</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  gem <span class="st">&quot;jekyll-feed&quot;</span>, <span class="st">&quot;~&gt; 0.6&quot;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>jekyll-compose は便利コマンドがほしかったので入れといた。<br />
テーマは minima。
テーマはこだわっても仕方がないし、Webデザインをアピールしたいわけでもないので、このままでいいや。</p>
<h2 id="ghostからの移行">Ghostからの移行</h2>
<p>Ghostはブログのデータをexportする機能がlabに含まれているので、それを使用。<a
href="https://help.ghost.org/hc/en-us/articles/224112927-Import-Export-Data">参考</a><br />
Content-Security-Policy
の設定が厳しいからかダウンロードダイアログが出なかったので、URLをコピって直接ダウンロードした。</p>
<p>GhostがexportするフォーマットはJSONであるため、Markdownに変換する必要がある。<br />
<a
href="https://github.com/eloyesp/jekyll_ghost_importer">jekyll_ghost_importer</a>
を使うと、Ghostがexportしたデータから_postディレクトリ内にMarkdownファイルを生成してくれるので、それをありがたく使わせていただいた。<br />
ただ、バージョン0.4.0では、ブログエントリか静的ページかを問わず、全てのコンテンツを_postsに出力してしまうため、Jekyllで静的ページをブログエントリにしたくない場合は手作業でファイルを移動したりlayout設定を変更したりしなければならない。<br />
（エントリ内画像はどのようにexportされるかはexportしたブログエントリ内に画像が含まれていないので分からない）</p>
<h2
id="カスタムドメインのhttpsについて">カスタムドメインのHTTPSについて</h2>
<p>以前は、Ghostを適当な非公開portでlistenさせておいて、Nginxでリバースプロキシ
&amp; HTTPS化させていた。 Github pageにも <a
href="https://blog.thara.jp">https://blog.thara.jp</a>
でアクセスできるように以下のようにNginxを設定。</p>
<pre><code>server {
    listen       443;
    server_name  blog.thara.jp;
(略)
    location / {
        proxy_pass https://{Github page URL};
        proxy_intercept_errors on;
        expires off;
    }
}</code></pre>
<p>だいたいブログの構築して満足してしまって全然エントリを書けていない・・・</p>
<p>2017年は週1で更新できるように頑張る ✊</p>
    </article>
  </div>
<footer>
  <small>
    <a href="https://thara.dev">thara.jp</a>
    | &copy; 2024 Tomochika Hara
  </small></footer>
</body>
</html>
